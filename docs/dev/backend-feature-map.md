# Whatpro Hub â€” Backend Feature Map (Atual)

## Contexto
Fonte: leitura direta do backend em pps/api.
Status: 2026-02-08

Legenda:
- âœ… Implementado
- ğŸŸ¡ Parcial
- âŒ Ausente

## Mapa por Feature

**Auth e SessÃµes**
- SSO Chatwoot (POST /api/v1/auth/sso) âœ…
- Refresh token (POST /api/v1/auth/refresh) âŒ (retorna Not Implemented)
- Logout (POST /api/v1/auth/logout) ğŸŸ¡ (stub)
- SessÃµes por dispositivo (model existe) âŒ (sem endpoints)
- API Key auth (model + middleware existem) âŒ (sem CRUD/gestÃ£o)

**Tenant / RBAC / Guards**
- Middleware JWT âœ…
- RequireRole âœ…
- RequireAccountAccess âœ…
- Enforcement em rotas account-scoped âœ… (teams/users/providers/boards)
- Enforcement global (todas as rotas sensÃ­veis) ğŸŸ¡ (faltam rotas futuras)

**Accounts**
- CRUD accounts âœ…
- Sync accounts (Chatwoot) ğŸŸ¡ (bÃ¡sico)

**Users/Teams**
- CRUD users âœ…
- CRUD teams âœ…
- Team members âœ…

**Providers / InstÃ¢ncias**
- CRUD providers âœ…
- Campos de instÃ¢ncia (instance_name, base_url, health_check) âœ…
- Quota de providers (entitlements) âœ…
- Provider instance separado âŒ
- Quota por tipo/instÃ¢ncia âŒ

**Inboxes**
- Model/handlers de inbox âŒ
- Quota de inbox ğŸŸ¡ (TODO no service)

**Kanban (Boards/Stages/Cards)**
- CRUD boards âœ…
- CRUD stages âœ…
- CRUD cards âœ…
- Reorder stages âœ…
- History/mÃ©tricas SLA âœ… (model existe, mÃ©tricas faltam)

**Chat Interno**
- Proxy Chatwoot (/api/v1/chatwoot/*) âœ…
- Webhooks Chatwoot âœ…
- Processamento real (criar/mover cards, sync) ğŸŸ¡ (TODOs)
- Chat interno prÃ³prio (backend MVP) âœ…
- UI/realtime âŒ

**Billing / Pagamento**
- Webhook Asaas âœ…
- Subscribe account âœ… (mas mocka account_id/user_id)
- Status real de assinatura por tenant âŒ
- Entitlements por plano ğŸŸ¡ (modelo existe, enforcement parcial)

**Entitlements / Quotas**
- AccountEntitlements model âœ…
- CanCreateResource âœ…
- Enforcement em providers âœ…
- Enforcement em users/teams/inboxes/integrations ğŸŸ¡

**Observabilidade / Auditoria**
- Health + metrics âœ…
- AuditLog model âœ…
- Audit em accounts/providers/boards ğŸŸ¡
- Audit global em aÃ§Ãµes crÃ­ticas âŒ

## Endpoints (Resumo)

**PÃºblicos**
- GET /health/live âœ…
- GET /health/ready âœ…
- GET /health/deep âœ…
- GET /metrics âœ…
- GET /swagger/* âœ…
- POST /api/v1/auth/sso âœ…
- POST /api/v1/auth/refresh âŒ
- POST /api/v1/webhooks/chatwoot ğŸŸ¡
- POST /api/v1/webhooks/asaas ğŸŸ¡
- POST /api/v1/webhooks/evolution/:instanceId ğŸŸ¡
- POST /api/v1/webhooks/test âœ…

**Protegidos**
- POST /api/v1/auth/logout ğŸŸ¡
- GET /api/v1/auth/me âœ…
- GET /api/v1/accounts âœ…
- GET /api/v1/accounts/:id âœ…
- POST /api/v1/accounts âœ…
- PUT /api/v1/accounts/:id âœ…
- POST /api/v1/accounts/sync ğŸŸ¡
- GET /api/v1/accounts/:accountId/teams âœ…
- POST /api/v1/accounts/:accountId/teams âœ…
- PUT /api/v1/accounts/:accountId/teams/:id âœ…
- DELETE /api/v1/accounts/:accountId/teams/:id âœ…
- GET /api/v1/accounts/:accountId/teams/:id/members âœ…
- POST /api/v1/accounts/:accountId/teams/:id/members âœ…
- DELETE /api/v1/accounts/:accountId/teams/:id/members/:userId âœ…
- GET /api/v1/accounts/:accountId/users âœ…
- POST /api/v1/accounts/:accountId/users âœ…
- PUT /api/v1/accounts/:accountId/users/:id âœ…
- DELETE /api/v1/accounts/:accountId/users/:id âœ…
- GET /api/v1/accounts/:accountId/providers âœ…
- POST /api/v1/accounts/:accountId/providers âœ…
- GET /api/v1/accounts/:accountId/providers/:id âœ…
- PUT /api/v1/accounts/:accountId/providers/:id âœ…
- DELETE /api/v1/accounts/:accountId/providers/:id âœ…
- GET /api/v1/accounts/:accountId/providers/:id/health âœ…
- GET /api/v1/accounts/:accountId/boards âœ…
- POST /api/v1/accounts/:accountId/boards âœ…
- PUT /api/v1/accounts/:accountId/boards/:id âœ…
- DELETE /api/v1/accounts/:accountId/boards/:id âœ…
- GET /api/v1/boards/:boardId/stages âœ…
- POST /api/v1/boards/:boardId/stages âœ…
- PUT /api/v1/boards/:boardId/stages/:id âœ…
- DELETE /api/v1/boards/:boardId/stages/:id âœ…
- POST /api/v1/boards/:boardId/stages/reorder âœ…
- GET /api/v1/boards/:boardId/cards âœ…
- POST /api/v1/boards/:boardId/cards âœ…
- PUT /api/v1/boards/:boardId/cards/:id âœ…
- POST /api/v1/boards/:boardId/cards/:id/move âœ…
- DELETE /api/v1/boards/:boardId/cards/:id âœ…
- GET /api/v1/accounts/:accountId/chat/rooms âœ…
- POST /api/v1/accounts/:accountId/chat/rooms âœ…
- GET /api/v1/accounts/:accountId/chat/rooms/:roomId âœ…
- POST /api/v1/accounts/:accountId/chat/rooms/:roomId/members âœ…
- DELETE /api/v1/accounts/:accountId/chat/rooms/:roomId/members/:userId âœ…
- GET /api/v1/accounts/:accountId/chat/rooms/:roomId/messages âœ…
- POST /api/v1/accounts/:accountId/chat/rooms/:roomId/messages âœ…
- DELETE /api/v1/accounts/:accountId/chat/messages/:messageId âœ…
- POST /api/v1/accounts/:accountId/chat/rooms/:roomId/read âœ…
- ALL /api/v1/chatwoot/* âœ…

## Gaps PrioritÃ¡rios (P0)
- Refresh token + sessions + revogaÃ§Ã£o
- Billing real com account_id/user_id reais
- Inboxes model + CRUD + entitlements
- Entitlements enforcement em users/teams/inboxes
- Webhooks Chatwoot aplicando mudanÃ§as reais
- Auditoria completa em aÃ§Ãµes crÃ­ticas
